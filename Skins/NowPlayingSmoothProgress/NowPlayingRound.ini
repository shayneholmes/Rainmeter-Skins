; Based on minima NowPlaying 1.1
; http://gazettefreak.deviantart.com/art/minima-NowPlaying-1-1-for-Rainmeter-288368191
; Altered by Shayne Holmes: Tuesday, 13 October 2015

;Metadata added by RainBrowser
;http://rainmeter.net/RainCMS/?q=Rainmeter101_AnatomyOfASkin

[Rainmeter]
Update=50
Author=simon.snth@xoxy.net

[Metadata]
Name=Now playing progress bar: big and smooth
Config=
Description=
Instructions=
Version=1.1
Tags=NowPlaying, 
License=Creative Commons Attribution-Noncommercial-Share Alike 3.0 License
Variant=

[Variables]
ChevronHalfHeight = 5
CircleRadius=50
CircleWidth=13

StartAngle=0

LineColor1=077d9bff
LineColor2=211,88,34,255
LineColor3=182,64,44,255
BackgroundColor=115161ff

NumberOfSegments=1

; TheAngle=[*mProgressInterpolated*]*2*PI+{#StartAngle#+1.571+%%*PI/#NumberOfSegments#}

; matches Rainmeter update, here for the interpolated progress script
Update=50

;============================
; constants (don't edit!)
;============================
SCRIPT=#@#scripts/
INC=#@#includes/

@Include=#INC#BaseSettings.inc


; STYLE
[CircleStyle]
W=(#CircleRadius#*2)
H=(#CircleRadius#*2)
LineLength=#CircleRadius#
LineStart=(#CircleRadius#-#CircleWidth#)
LineColor=#LineColor1#
StartAngle=(([mProgressInterpolated]/2-[mAngleHash])*2*PI*([mDirection]-0.5))
Solid=1
AntiAlias=1
DynamicVariables=1

;=======================================
; Meters

@Include=#INC#NowPlayingBase.inc

[mOneNth]
Measure=Calc
Formula=(1/2/#NumberOfSegments#)
UpdateDivider=-1

[mProgressInterpolated]
Measure=Script
ScriptFile=#SCRIPT#SmoothProgress.lua

[mAngleHash]
; riffing on https://www.cs.hmc.edu/~geoff/classes/hmc.cs070.200101/homework10/hashfuncs.html
Measure=Calc
Formula=((1+Random)*0.5*(Sqrt(5)-1)) % 1
UpdateRandom=1
UpdateDivider=-1
Group=UpdateOnTrackChange

[mDirection]
Measure=Calc
Formula=Random > 50 ? 1 : -1
UpdateRandom=1
LowBound=0
HighBound=100
UpdateDivider=-1
Group=UpdateOnTrackChange

;~~~~~~~~~~~~~~~~Main~~~~~~~~~~~~~~~~~~~
[ProgressCircleBackground]
MeterStyle=CircleStyle
Meter=Roundline
MeasureName=mOne
LineColor=#BackgroundColor#
UpdateDivider=-1

[ProgressCircle]
Meter=Shape
; Outer circle
Shape =Rectangle 0,0,(#CircleRadius#*2),(#CircleRadius#*2),(#CircleRadius#) | FillColor #LineColor1# | StrokeWidth 0
; Inner circle
Shape2=Rectangle (#CircleWidth#),(#CircleWidth#),(#CircleRadius#*2-#CircleWidth#*2),(#CircleRadius#*2-#CircleWidth#*2),(#CircleRadius#-#CircleWidth#)
; Use as a progress meter
Shape3=Rectangle 0,0,(#CircleRadius#*2)+5,(#CircleRadius#*2) | Scale (1-[mProgressInterpolated]), 1, (#CircleRadius#*2), 0
; Subtract
Shape4=Combine Shape | Exclude Shape2 | Exclude Shape3 | Rotate ([mAngleHash]*360), (#CircleRadius#), (#CircleRadius#)
DynamicVariables=1
